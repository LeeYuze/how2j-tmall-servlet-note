### How2j-Tmall-Servleté¡¹ç›®foreè·¯ç”±æœºåˆ¶å®ç°

### å‰è¨€ï¼š

é¦–å…ˆï¼Œæˆ‘å¿…é¡»æ‰¿è®¤è¿™ä¸€æ‹›é€šè¿‡åå°„æœºåˆ¶å®ç°è·¯ç”±æ–¹å¼ç¡®å®å¾ˆé…·ï¼Œå°¤å…¶æ˜¯å¯¹äºæˆ‘è¿™ç§åˆšæ¥è§¦JAVAçš„å°èœé¸¡æ¥è¯´

> index.jsp
>
> ```
> <jsp:forward page="forehome"/>
> ```

æˆ‘ä»¬é€šè¿‡é¦–é¡µæ–‡ä»¶ï¼Œå¯ä»¥çœ‹å‡ºå®ƒå…¶å®æ˜¯åšäº†ä¸ªforwardçš„è·³è½¬ï¼Œåˆ°äº†forehomeè¿™ä¸ªé“¾æ¥ä¸Š

ä½†æ˜¯å½“æˆ‘æ»¡æ€€æœŸå¾…çš„å»web.xmlæ–‡ä»¶å»æ‰¾/forehomeè¿™ä¸ªé“¾æ¥æ—¶çš„æ—¶å€™ï¼Œç¼ºå‹æ ¹æ‰¾ä¸åˆ°è¿™ä¸ªé“¾æ¥çš„<servlet-map>æ ‡ç­¾ï¼Œè¿™æˆ‘å°±ååˆ†çº³é—·äº†ï¼Œå®ƒæ²¡åœ¨web.xmlæ–‡ä»¶æ³¨å†Œï¼Œé‚£å®ƒæ˜¯æ€ä¹ˆèƒ½å¤Ÿè¢«æ‰§è¡Œçš„å‘¢ï¼Ÿ



### forehomeå¦‚ä½•æ‰§è¡Œï¼Ÿ

å¸¦ç€ä¸Šé¢çš„ç–‘é—®ï¼Œæˆ‘åœ¨Ideaä¸ŠæŒ‰ä¸‹äº†<kbd>commandÂ </kbd>+ <kbd>shift</kbd>+<kbd>F</kbd>å…¨å±€æœç´¢â€œforehomeâ€å…³é”®å­—ï¼Œæœ€ç»ˆåœ¨servlet.ForeServletæ–‡ä»¶å®šä½åˆ°äº†è¿™ä¸ªå…³é”®å­—ï¼Œ

åˆ†åˆ«æ˜¯åœ¨ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°é‡Œè¿”å›

```
public String login(HttpServletRequest request, HttpServletResponse response, Page page) 

public String logout(HttpServletRequest request, HttpServletResponse response, Page page) {
```

ä½†æ˜¯çœ‹è¿™ä¸ªå‡½æ•°åï¼Œå¾ˆæ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç­”æ¡ˆï¼Œå¹¶ä¸”å®ƒä»¬çš„è¿”å›å€¼éƒ½æ˜¯â€œ@forehomeâ€ï¼Œè¿™è®©æˆ‘ä»¬åˆå¤šäº†ä¸€ä¸ªç–‘é—®ğŸ¤”ï¸ï¼Œä¸ºä»€ä¹ˆå‰é¢è¦åŠ ä¸ªâ€œ@â€ã€‚



æˆ‘ä»¬çŸ¥é“æŒ‰ç…§How2jä½œè€…çš„å°¿æ€§ï¼Œä¸€èˆ¬æ”¾åœ¨servletç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œéƒ½ä¼šè·‘å»web.xmlæ–‡ä»¶å»æ³¨å†Œä¸€ä¸‹ï¼Œéšåæˆ‘æ‰“å¼€äº†ä¸‹web.xmlæ–‡ä»¶ï¼Œæœä¸å…¶ç„¶è¿˜çœŸæ‰¾åˆ°äº†è¿™ä¸ªservletæ–‡ä»¶çš„æ³¨å†Œxml

```
<servlet-mapping>
	<servlet-name>ForeServlet</servlet-name>
	<url-pattern>/foreServlet</url-pattern>
</servlet-mapping>
```

è®©æˆ‘ä»¬å…¨å±€æœç´¢ä¸€ä¸‹â€œ/foreServletâ€è¿™æ¡é“¾æ¥

![image-20211122093033773](/Users/lihaohui/Library/Application Support/typora-user-images/image-20211122093033773.png)

æœ€ç»ˆæˆ‘å®šä½åˆ°äº†filter.ForeServletFilterè¿™ä¸ªæ‹¦æˆªå™¨æ–‡ä»¶

```
if (uri.startsWith("/fore") && !uri.startsWith("/foreServlet"))
```

é€šè¿‡è¿™ä¸ªIFè¯­å¥æˆ‘ä»¬ä¸éš¾çœ‹åˆ°ï¼Œå¦‚æœé“¾æ¥ä¸­å¼€å¤´å¸¦æœ‰/fore ä¸” ä¸æ˜¯ä»¥/foreServlet

å¼€å¤´æ—¶ï¼Œå°†æ‰§è¡Œä¸‹é¢ä»£ç 

```
String method = StringUtils.substringAfterLast(uri, "/fore");
request.setAttribute("method", method);
req.getRequestDispatcher("/foreServlet").forward(request, response);
return;
```

ä»methodå˜é‡æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œå®ƒå°†æŠŠå­—ç¬¦ä¸²ä¸­çš„/foreç»™ç§»é™¤æ‰ï¼Œå°±æ¯”å¦‚/forehomeåˆ™å˜ä¸ºhomeå­—ç¬¦ä¸²ã€‚

éšåå°†è¿™ä¸ªå­—ç¬¦ä¸²æ”¾åˆ°requestä½œç”¨åŸŸé‡Œï¼Œç”¨â€œmethodâ€ä½œä¸ºkeyåå­˜å‚¨èµ·æ¥ã€‚

> gagagaga

æˆ‘ä»¬å›åˆ°**servlet.ForeServlet**è¿™ä¸ªæ–‡ä»¶é‡Œï¼ŒæŒ‰ç…§method = homeçš„è¯ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ä¸‹é¢å‡½æ•°

```
public String home(HttpServletRequest request, HttpServletResponse response, Page page) {
```

å®ƒè¿”å›äº†ä¸€ä¸ªå­—ç¬¦ä¸²

```
return "home.jsp";
```

æˆ‘ä»¬æ‰“å¼€home.jspï¼Œä¼šå‘ç°è¿™ä¸ªå°±æ˜¯é¦–é¡µçš„jspæ–‡ä»¶ï¼ï¼ä½†æ˜¯å®ƒåˆæ˜¯æ€ä¹ˆè®©forehomeè·³è½¬åˆ°è¿™ä¸ªæ–‡ä»¶é‡Œçš„å‘¢ï¼Ÿ

```
public class ForeServlet extends BaseForeServlet
```

é€šè¿‡è¿™è¡Œä»£ç ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°è¿™ä¸ªç±»å…¶å®ç»§æ‰¿äº†**BaseForeServlet**

```
String method = (String) request.getAttribute("method");

Method m = this.getClass().getMethod(method, javax.servlet.http.HttpServletRequest.class,
javax.servlet.http.HttpServletResponse.class, Page.class);

String redirect = m.invoke(this, request, response, page).toString();
```

æˆ‘ä»¬é€šè¿‡**BaseForeServlet**æ–‡ä»¶å¯ä»¥çœ‹åˆ°ä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥è¿›è¡Œåˆ†æ

```
String method = (String) request.getAttribute("method");
```

æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªmethodçš„å­—ç¬¦ä¸²å˜é‡ï¼Œæ¥æ”¶requestä½œç”¨åŸŸé‡Œé¢çš„ï¼Œâ€œmethodâ€keyé‡Œé¢çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æ­¤æ—¶method = home

```
Method m = this.getClass().getMethod(method, javax.servlet.http.HttpServletRequest.class,
javax.servlet.http.HttpServletResponse.class, Page.class);
```

è¿™æ®µä»£ç çš„æ„æ€æ˜¯ï¼Œè·å–è‡ªèº«ç±»ï¼ˆåŒ…æ‹¬å­ç±»ï¼‰ä¸‹é¢çš„å‡½æ•°æ–¹æ³•ï¼Œæˆ‘ä»¬çŸ¥é“methodé‡Œé¢å­˜å‚¨çš„æ˜¯home

```
public String home(HttpServletRequest request, HttpServletResponse response, Page page) {
  List<Category> cs= new CategoryDAO().list();
  new ProductDAO().fill(cs);
  new ProductDAO().fillByRow(cs);
  request.setAttribute("cs", cs);
  return "home.jsp";
}
```

é‚£ä¹ˆå…¶å®å°±æ˜¯å¯¹åº”å­ç±»çš„ä¸Šé¢ä»£ç 

```
String redirect = m.invoke(this, request, response, page).toString();
```

éšåæˆ‘ä»¬é€šè¿‡**invoke**æ–¹æ³•æ¥æ‰§è¡Œåˆšåˆšæˆ‘ä»¬åå°„å‡ºæ¥çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæœ€åçš„æ‰§è¡Œç»“æœå°±æ˜¯

```
String redirect = "home.jsp"
```

å¾ˆå¿«å¾ˆå¿«å¾ˆå¿«ï¼Œå°±è¦æ¥è¿‘ç­”æ¡ˆäº†

```
if (redirect.startsWith("@"))
	response.sendRedirect(redirect.substring(1));
else if (redirect.startsWith("%"))
	response.getWriter().print(redirect.substring(1));
else
  request.getRequestDispatcher(redirect).forward(request, response);
```

å¤§å®¶çœ‹ä¸Šé¢ä»£ç ï¼Œæ‰§è¡Œäº†ä¸€æ®µIFè¯­å¥ï¼Œåˆ¤æ–­**redirect**å˜é‡æ”¶å¦ä»¥â€œ@â€æˆ–â€œ%â€å­—ç¬¦ä¸²å¼€å¤´ï¼Œå¦åˆ™å°†æ‰§è¡Œä¸‹é¢ä»£ç 

```
request.getRequestDispatcher(redirect).forward(request, response);
```

è¿™ä¸€æ®µä»£ç ï¼Œå­¦è¿‡è¿‡Servletçš„åŒå­¦è‚¯å®šçŸ¥é“ï¼Œè¿™ä»–ä¸«ä¸å°±æ˜¯æœåŠ¡ç«¯è·³è½¬å—ï¼Ÿå¯¹ï¼Œæ²¡é”™å°±æ˜¯æœåŠ¡ç«¯è·³è½¬ï¼Œä¹Ÿå°±æ˜¯å…¶å®åœ¨è®¿é—®/forehomeçš„æ—¶å€™ï¼Œä¼šæ‰¾homeè¿™ä¸ªå‡½æ•°ï¼Œè€Œå®ƒè¿”å›â€œhome.jspâ€å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæœ€ç»ˆå°†è¿›è¡ŒæœåŠ¡ç«¯è·³è½¬åˆ°home.jspè¿™ä¸ªæ–‡ä»¶é‡Œ

> ä¸ºä»€ä¹ˆå‰é¢è¦åŠ ä¸ªâ€œ@â€?

åˆšåˆšå‰é¢æˆ‘ä»¬æœ‰ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆæœ‰ä¸ªâ€@â€œï¼Ÿ

å…¶å®ä¸Šé¢çš„ä»£ç å·²ç»å‘Šè¯‰æˆ‘ä»¬äº†ï¼Œå¦‚æœä»¥â€œ@â€å¼€å¤´ï¼Œé‚£ä¹ˆå°†è¿›è¡Œå®¢æˆ·ç«¯è·³è½¬ã€‚ä¹Ÿå°±æ˜¯è®©æµè§ˆå™¨è·³è½¬åˆ°è¿™ä¸ªé“¾æ¥
